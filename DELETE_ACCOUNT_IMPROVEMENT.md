# ุชุญุณููุงุช ุญุฐู ุงูุญุณุงุจ - Delete Account Improvements

## ๐ฏ **ุงูุชุญุณููุงุช ุงููุทุจูุฉ:**

### โ **1. ุฅุฒุงูุฉ ุฌููุน ุงูุจูุงูุงุช ูู ุงูู Body**
- **ูุจู:** ูุงู ูุชุทูุจ ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ ูุณุจุจ ุงูุญุฐู
- **ุจุนุฏ:** ุญุฐู ูุจุงุดุฑ ุนูุฏ ุงูุถุบุท ุนูู ุงูุฒุฑ ุจุฏูู ุฃู ุจูุงูุงุช
- **ุงูุณุจุจ:** ุชุจุณูุท ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู

### โ **2. ุญุฐู ุดุงูู ููุจูุงูุงุช ุงููุฑุชุจุทุฉ**
- **ุงูุญุณุงุจ:** soft delete ูุน ูุณุญ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ
- **ุงูุฃุนูุงู ุงููููุฉ:** soft delete ูุฅูุบุงุก ุงูุชููุฑ
- **ุงูุชููููุงุช:** soft delete
- **ุฑุณุงุฆู ุงูุดุงุช:** soft delete
- **ุงูุฅุดุนุงุฑุงุช:** ุญุฐู ูุงูู
- **ุงูุทูุจุงุช ุงูุฎุงุตุฉ:** ุฅูุบุงุก
- **ุงููุนุงููุงุช ุงููุนููุฉ:** ุฅูุบุงุก
- **ุงููุชุงุจุนุงุช:** ุญุฐู ูุงูู
- **ุงูุชูุงุฑูุฑ:** ุฅูุบุงุก
- **ุงูุฑููุฒ:** ุญุฐู ูุงูู

### โ **3. ุงุณุชุฎุฏุงู Transactions**
- **ุถูุงู ุงูุงุชุณุงู:** ุฅูุง ูุฌุญ ุงูุญุฐู ูุงููุงู ุฃู ูุดู ูุงููุงู
- **Rollback:** ูู ุญุงูุฉ ุงูุฎุทุฃ ูุชู ุงูุชุฑุงุฌุน ุนู ุฌููุน ุงูุชุบููุฑุงุช

### โ **4. ุชุญุณูู ุงูุฃูุงู**
- **ูุณุญ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ:** ุงูุจุฑูุฏ ุงูุฅููุชุฑูููุ ุงูุงุณูุ ุงูุตูุฑุฉ
- **ุฅูุบุงุก FCM tokens:** ููุน ุงูุฅุดุนุงุฑุงุช
- **ุฅููุงู ุงูุฅุดุนุงุฑุงุช:** ุชุนุทูู ุฌููุน ุฃููุงุน ุงูุฅุดุนุงุฑุงุช

## ๐ง **ุงูุชุบููุฑุงุช ุงูุชูููุฉ:**

### 1. **Controller Changes:**
```javascript
// ูุจู
const { password, reason } = req.body;
const isPasswordValid = await bcryptjs.compare(password, user.password);

// ุจุนุฏ
const { reason } = req.body;
// ูุง ููุฌุฏ ุชุญูู ูู ูููุฉ ุงููุฑูุฑ
```

### 2. **Validation Changes:**
```javascript
// ูุจู
export const deleteAccountSchema = joi.object({
  password: joi.string().required(),
  reason: joi.string().max(500).optional()
});

// ุจุนุฏ
export const deleteAccountSchema = joi.object({
  reason: joi.string().max(500).optional()
});
```

### 3. **Swagger Documentation:**
```yaml
# ูุจู
requestBody:
  required: true
  properties:
    password:
      type: string
      required: true
    reason:
      type: string
      optional: true

# ุจุนุฏ
requestBody:
  required: false
  description: No request body required - account deletion happens immediately
```

## ๐ **ุงูุจูุงูุงุช ุงูุชู ูุชู ุญุฐููุง:**

### 1. **ุญุณุงุจ ุงููุณุชุฎุฏู:**
- `isActive: false`
- `isDeleted: true`
- `deletedAt: new Date()`
- `deleteReason: reason || 'User requested'`
- `email: deleted_${timestamp}_${originalEmail}`
- `displayName: 'ูุณุชุฎุฏู ูุญุฐูู'`
- `fcmTokens: []`
- `notificationSettings: { enablePush: false, enableEmail: false, muteChat: true }`

### 2. **ุงูุฃุนูุงู ุงููููุฉ:**
- `isAvailable: false`
- `isDeleted: true`
- `deletedAt: new Date()`
- `deleteReason: 'Artist account deleted'`

### 3. **ุงูุชููููุงุช:**
- `status: 'deleted'`
- `deletedAt: new Date()`
- `deleteReason: 'User account deleted'`

### 4. **ุฑุณุงุฆู ุงูุดุงุช:**
- `isDeleted: true`
- `deletedAt: new Date()`
- `content: 'ุฑุณุงูุฉ ูุญุฐููุฉ'`
- `text: 'ุฑุณุงูุฉ ูุญุฐููุฉ'`

### 5. **ุงูุทูุจุงุช ุงูุฎุงุตุฉ:**
- `status: 'cancelled'`
- `cancelledAt: new Date()`
- `cancellationReason: 'User account deleted'`

### 6. **ุงููุนุงููุงุช ุงููุนููุฉ:**
- `status: 'cancelled'`
- `cancelledAt: new Date()`
- `cancellationReason: 'User account deleted'`

### 7. **ุญุฐู ูุงูู:**
- ุงูุฅุดุนุงุฑุงุช
- ุงููุชุงุจุนุงุช
- ุงูุชูุงุฑูุฑ
- ุงูุฑููุฒ (tokens)

## ๐ **ุชุญุฏูุซุงุช Swagger:**

### **ุงูุชุบููุฑุงุช ุงููุทุจูุฉ:**
- โ **ุฅุฒุงูุฉ requestBody:** ูุง ุญุงุฌุฉ ูุฅุฑุณุงู ุฃู ุจูุงูุงุช
- โ **ุชูุซูู ุดุงูู:** ุดุฑุญ ููุตู ููุง ูุชู ุญุฐูู
- โ **ุฃูุซูุฉ ูุงุถุญุฉ:** ุงุณุชุฌุงุจุงุช ููุตูุฉ ููู ุญุงูุฉ
- โ **ุชุญุฐูุฑุงุช ุงูุฃูุงู:** ุชูุจูู ุฃู ุงูุนูููุฉ ูุง ูููู ุงูุชุฑุงุฌุน ุนููุง

### **ุงูุชูุซูู ุงูุฌุฏูุฏ ูุชุถูู:**
- **Features:** ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ
- **What gets deleted:** ูุง ูุชู ุญุฐูู ุจุงูุชูุตูู
- **Security:** ุฅุฌุฑุงุกุงุช ุงูุฃูุงู
- **Note:** ุชุญุฐูุฑ ุฃู ุงูุนูููุฉ ูุง ูููู ุงูุชุฑุงุฌุน ุนููุง

## ๐งช **ุงุฎุชุจุงุฑ ุงูุญุฐู:**

### **Script ุงูุงุฎุชุจุงุฑ:**
```bash
# ุงุฎุชุจุงุฑ ุฃุณุงุณู
node scripts/test-delete-account.js

# ุงุฎุชุจุงุฑ ูุณุชุฎุฏู ูุญุฏุฏ
node scripts/test-delete-account.js <userId> <token>
```

### **ุงุฎุชุจุงุฑุงุช Postman:**
```http
# ุญุฐู ุจุฏูู ุจูุงูุงุช (ุงูุทุฑููุฉ ุงูุฌุฏูุฏุฉ)
DELETE /api/user/delete-account
Authorization: Bearer <token>

# ูุง ุญุงุฌุฉ ูุฅุฑุณุงู ุฃู ุจูุงูุงุช ูู ุงูู body
```

## ๐ **ุงูุฃูุงู:**

### **1. ุงูุชุญูู ูู ุงูุตูุงุญูุงุช:**
- ุงููุณุชุฎุฏู ููููู ุญุฐู ุญุณุงุจู ููุท
- ูุง ูููู ุญุฐู ุญุณุงุจุงุช ุฃุฎุฑู

### **2. ุญูุงูุฉ ุงูุจูุงูุงุช:**
- ูุณุญ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ
- ุงูุงุญุชูุงุธ ุจุณุฌู ุงูุญุฐู ููุชุฏููู

### **3. ููุน ุงููุตูู:**
- ุฅูุบุงุก ุฌููุน ุงูุฑููุฒ
- ุชุนุทูู ุงูุฅุดุนุงุฑุงุช

## ๐ **ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**

### **1. ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู:**
- โ ุญุฐู ุณุฑูุน ููุจุงุดุฑ
- โ ูุง ุญุงุฌุฉ ููููุฉ ุงููุฑูุฑ
- โ ุชุฃููุฏ ููุฑู ููุญุฐู

### **2. ุณูุงูุฉ ุงูุจูุงูุงุช:**
- โ ุญุฐู ุดุงูู ูุฌููุน ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ
- โ ุนุฏู ุชุฑู ุจูุงูุงุช ูุนููุฉ
- โ ุณุฌู ุชุฏููู ููุญุฐู

### **3. ุงูุฃุฏุงุก:**
- โ ุงุณุชุฎุฏุงู transactions ููุงุชุณุงู
- โ ุญุฐู ูุชูุงุฒู ููุจูุงูุงุช ุงููุฑุชุจุทุฉ
- โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ุตุญูุญ

## ๐ **ููููุฉ ุงูุงุณุชุฎุฏุงู:**

### **ูู Flutter:**
```dart
// ุญุฐู ุงูุญุณุงุจ (ุงูุทุฑููุฉ ุงูุฌุฏูุฏุฉ)
await deleteAccount();

// ูุง ุญุงุฌุฉ ูุฅุฑุณุงู ุฃู ุจูุงูุงุช - ุงูุญุฐู ูุญุฏุซ ูุจุงุดุฑุฉ
```

### **ูู React/Web:**
```javascript
// ุญุฐู ุงูุญุณุงุจ (ุงูุทุฑููุฉ ุงูุฌุฏูุฏุฉ)
await fetch('/api/user/delete-account', {
  method: 'DELETE',
  headers: {
    'Authorization': `Bearer ${token}`
  }
});

// ูุง ุญุงุฌุฉ ูุฅุฑุณุงู ุฃู ุจูุงูุงุช ูู ุงูู body
```

### **ูู Postman:**
```http
DELETE /api/user/delete-account
Authorization: Bearer <your_token>

# ูุง ุญุงุฌุฉ ูุฅุฑุณุงู ุฃู ุจูุงูุงุช ูู ุงูู body
```

## ๐ **ููุงุญุธุงุช ูููุฉ:**

1. **ูุง ูููู ุงูุชุฑุงุฌุน:** ุงูุญุฐู ููุงุฆู ููุง ูููู ุงุณุชุนุงุฏุฉ ุงูุญุณุงุจ
2. **ุงูุจูุงูุงุช ุงููุญุฐููุฉ:** ูุชู ุงูุงุญุชูุงุธ ุจุณุฌู ููุญุฐู ููุชุฏููู
3. **ุงููุนุงููุงุช ุงูููุชููุฉ:** ูุง ูุชู ุญุฐู ุงููุนุงููุงุช ุงูููุชููุฉ
4. **ุงูุจูุงูุงุช ุงูุนุงูุฉ:** ูุฏ ุชุจูู ุจุนุถ ุงูุจูุงูุงุช ุงูุนุงูุฉ ูู ุงููุธุงู

## ๐ **ุงูุฎูุงุตุฉ:**

ุชู ุชุทุจูู ุชุญุณููุงุช ุดุงููุฉ ุนูู ูุธุงู ุญุฐู ุงูุญุณุงุจ:
- โ ุชุจุณูุท ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
- โ ุญุฐู ุดุงูู ููุจูุงูุงุช ุงููุฑุชุจุทุฉ
- โ ุฃูุงู ูุญุณู
- โ ุฃุฏุงุก ุฃูุถู
- โ ุชูุซูู ุดุงูู
- โ ุงุฎุชุจุงุฑุงุช ุดุงููุฉ
