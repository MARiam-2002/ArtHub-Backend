# ๐ธ ุฏููู ุงูุชุนุงูู ูุน ุงูุตูุฑ ูู Flutter - ุฅูุดุงุก ุงูุฃุนูุงู ุงููููุฉ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุจูุงุกู ุนูู ูุงุฌูุฉ ุงููุณุชุฎุฏู "ุงุถุงูุฉ ุนูู"ุ ูุชู ุงูุชุนุงูู ูุน ุงูุตูุฑ ุจุทุฑููุฉ ูุงุญุฏุฉ ููุท:

**ุฑูุน ูููุงุช ุงูุตูุฑ ูุจุงุดุฑุฉ** (ุงูุทุฑููุฉ ุงููุญูุฏุฉ ุงููุฏุนููุฉ)

## โ ุฅุฌุงุจุฉ ุนูู ุฃุณุฆูุชู

### ุณุคุงู: "ุงูุตูุฑุฉ ุจุชุงุฎุฏููุง ู string ููุง ุงููุ"

**ุงูุฅุฌุงุจุฉ:** ุงูุตูุฑ ูุชู ุงูุชุนุงูู ูุนูุง ุจุทุฑููุชูู ูู ุงูู Backend:

#### 1๏ธโฃ **ุงูุทุฑููุฉ ุงููุฏุนููุฉ: ุฑูุน ูููุงุช ูุจุงุดุฑุฉ (Multipart Form Data)**
```dart
// โ ุงูุทุฑููุฉ ุงูุตุญูุญุฉ
final formData = FormData.fromMap({
  'title': 'ุนููุงู ุงูุนูู',
  'price': 100,
  'category': 'ุฑุณู',
  // ุงูุตูุฑ ููููุงุช
});

// ุฅุถุงูุฉ ุงูุตูุฑ ููููุงุช
formData.files.add(
  MapEntry('images', await MultipartFile.fromFile(imageFile.path))
);
```

#### 2๏ธโฃ **ุงูุทุฑููุฉ ุบูุฑ ุงููุฏุนููุฉ: ุฅุฑุณุงู ุฑูุงุจุท ูู string**
```dart
// โ ูุฐู ุงูุทุฑููุฉ ุบูุฑ ูุฏุนููุฉ ุญุงููุงู
final data = {
  'title': 'ุนููุงู ุงูุนูู',
  'price': 100,
  'category': 'ุฑุณู',
  'images': [
    'https://example.com/image1.jpg', // โ ูุง ูุนูู
    'https://example.com/image2.jpg'
  ]
};
```

### ุณุคุงู: "ูู ุงุณุชูุจูุชููุง ู string ูุชุจูุง ุญูุงุฑ ุนูุฏู ููุง ุจุณูุทูุ"

**ุงูุฅุฌุงุจุฉ:** ูู ุงุณุชูุจูุชูุง ูู stringุ ุณุชุญุชุงุฌ ุฅูู:

1. **ุชุญููู ุงูู string ุฅูู ููู** (ูุนูุฏ)
2. **ุฑูุนู ุนูู Cloudinary** (ูุนูุฏ)
3. **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก** (ูุนูุฏ)

**ุงููุชูุฌุฉ:** ูุนูุฏุฉ ุฌุฏุงู! ๐ซ

### ุณุคุงู: "ุนุดุงู ุงุจุนุชูุง ูู ุนูุฏู ููุงูู ูุงุฒู ูุชุนุงูู ูุน ุงูุฏุงุชุง ุจุชุงุนุชู ู formData"

**ุงูุฅุฌุงุจุฉ:** โ **ุตุญูุญ ุชูุงูุงู!**

```dart
// โ ุงูุทุฑููุฉ ุงูุตุญูุญุฉ
final formData = FormData.fromMap({
  'title': 'ุนููุงู ุงูุนูู',
  'price': 100,
  'category': 'ุฑุณู',
});

// ุฅุถุงูุฉ ุงูุตูุฑ ููููุงุช
for (File image in images) {
  formData.files.add(
    MapEntry('images', await MultipartFile.fromFile(image.path))
  );
}
```

### ุณุคุงู: "ูู ุดูุช ุงู line ุจุชุงุน ุงู content-type ุฏู ููุถุฑุจ ูุนุงูู ุตุญุ"

**ุงูุฅุฌุงุจุฉ:** โ **ุตุญูุญ ุชูุงูุงู!**

```dart
// โ ูุง ุชุญุชุงุฌ ูุชุญุฏูุฏ Content-Type ูุน Dio
final response = await dio.post(
  '/api/artworks',
  data: formData, // Dio ูุญุฏุฏ Content-Type ุชููุงุฆูุงู
  options: Options(
    headers: {
      'Authorization': 'Bearer $token',
      // ูุง ุชุญุชุงุฌ: 'Content-Type': 'multipart/form-data'
    },
  ),
);
```

### ุณุคุงู: "ูู ุจุนุชูู Content-Type: multipart/form-data ูุด ููุนูู ูุนุงูู ูุดูููุ"

**ุงูุฅุฌุงุจุฉ:** โ **ูุงุ ูู ูุณุจุจ ุฃู ูุดุงูู!**

```dart
// โ ูุฐุง ุขูู ุชูุงูุงู
final response = await dio.post(
  '/api/artworks',
  data: formData,
  options: Options(
    headers: {
      'Authorization': 'Bearer $token',
      'Content-Type': 'multipart/form-data', // โ ุขูู
    },
  ),
);
```

**ุงูุณุจุจ:** ุงูู Backend ูุชุนุงูู ูุน `multipart/form-data` ุจุดูู ุตุญูุญุ ุณูุงุก ุชู ุชุญุฏูุฏู ูุฏููุงู ุฃู ุชููุงุฆูุงู.

## ๐จ ุญู ูุดุงูู Flutter ุงูุดุงุฆุนุฉ

### ุงููุดููุฉ: "DioException: null" ูุน "Response: null"

**ุงูุณุจุจ:** ูุดููุฉ ูู ุฅุนุฏุงุฏ FormData ุฃู ุงูู headers

#### ุงูุญู 1: ุชุตุญูุญ ุฅุนุฏุงุฏ FormData
```dart
// โ ุฎุทุฃ ุดุงุฆุน
final formData = FormData.fromMap({
  'title': title,
  'price': price,
  'category': category,
  'image': imageFile, // โ ุฎุทุฃ
});

// โ ุงูุญู ุงูุตุญูุญ
final formData = FormData.fromMap({
  'title': title,
  'price': price.toString(), // ุชุญููู ุฅูู string
  'category': category,
});

// ุฅุถุงูุฉ ุงูุตูุฑ ุจุดูู ูููุตู
formData.files.add(
  MapEntry('images', await MultipartFile.fromFile(imageFile.path))
);
```

#### ุงูุญู 2: ุชุตุญูุญ ุงูู Headers
```dart
// โ ุฎุทุฃ ุดุงุฆุน
final response = await dio.post(
  '/api/artworks',
  data: formData,
  options: Options(
    headers: {
      'Authorization': 'Bearer $token',
      'Content-Type': 'multipart/form-data', // โ ูุฏ ูุณุจุจ ูุดุงูู
    },
  ),
);

// โ ุงูุญู ุงูุตุญูุญ
final response = await dio.post(
  '/api/artworks',
  data: formData,
  options: Options(
    headers: {
      'Authorization': 'Bearer $token',
      // ูุง ุชุญุฏุฏ Content-Type ูุฏููุงู
    },
    sendTimeout: Duration(seconds: 60), // ุฒูุงุฏุฉ ุงูู timeout
    receiveTimeout: Duration(seconds: 60),
  ),
);
```

#### ุงูุญู 3: ุฅุถุงูุฉ Error Handling
```dart
try {
  final response = await dio.post(
    '/api/artworks',
    data: formData,
    options: Options(
      headers: {'Authorization': 'Bearer $token'},
      sendTimeout: Duration(seconds: 60),
      receiveTimeout: Duration(seconds: 60),
    ),
  );
  
  print('โ Success: ${response.data}');
  
} on DioException catch (e) {
  print('โ Dio Error: ${e.message}');
  print('โ Error Type: ${e.type}');
  print('โ Error Response: ${e.response?.data}');
  print('โ Error Status: ${e.response?.statusCode}');
  
  // ูุนุงูุฌุฉ ุฃููุงุน ุงูุฃุฎุทุงุก ุงููุฎุชููุฉ
  switch (e.type) {
    case DioExceptionType.connectionTimeout:
      print('ุฎุทุฃ ูู ุงูุงุชุตุงู - ุงูุชูุช ูููุฉ ุงูุงุชุตุงู');
      break;
    case DioExceptionType.sendTimeout:
      print('ุฎุทุฃ ูู ุงูุฅุฑุณุงู - ุงูุชูุช ูููุฉ ุงูุฅุฑุณุงู');
      break;
    case DioExceptionType.receiveTimeout:
      print('ุฎุทุฃ ูู ุงูุงุณุชูุจุงู - ุงูุชูุช ูููุฉ ุงูุงุณุชูุจุงู');
      break;
    case DioExceptionType.badResponse:
      print('ุฎุทุฃ ูู ุงูุงุณุชุฌุงุจุฉ: ${e.response?.statusCode}');
      break;
    case DioExceptionType.cancel:
      print('ุชู ุฅูุบุงุก ุงูุทูุจ');
      break;
    default:
      print('ุฎุทุฃ ุบูุฑ ูุนุฑูู');
  }
} catch (e) {
  print('โ General Error: $e');
}
```

#### ุงูุญู 4: ุชุตุญูุญ ุงุณู ุงูุญูู
```dart
// โ ุฎุทุฃ ุดุงุฆุน - ุงุณู ุงูุญูู ุฎุงุทุฆ
formData.files.add(
  MapEntry('image', await MultipartFile.fromFile(imageFile.path)) // โ ุฎุทุฃ
);

// โ ุงูุญู ุงูุตุญูุญ - ุงุณู ุงูุญูู ุงูุตุญูุญ
formData.files.add(
  MapEntry('images', await MultipartFile.fromFile(imageFile.path)) // โ ุตุญูุญ
);
```

#### ุงูุญู 5: ูุซุงู ูุงูู ูุตุญุญ
```dart
Future<void> createArtwork({
  required String title,
  required int price,
  required String category,
  required File imageFile,
  required String token,
}) async {
  try {
    print('๐ ุจุฏุก ุฅูุดุงุก ุงูุนูู ุงูููู...');
    
    // ุฅูุดุงุก FormData
    final formData = FormData.fromMap({
      'title': title,
      'price': price.toString(), // ุชุญููู ุฅูู string
      'category': category,
    });

    // ุฅุถุงูุฉ ุงูุตูุฑุฉ
    formData.files.add(
      MapEntry(
        'images', // ุงุณู ุงูุญูู ุงูุตุญูุญ
        await MultipartFile.fromFile(
          imageFile.path,
          filename: 'artwork_${DateTime.now().millisecondsSinceEpoch}.jpg',
        ),
      ),
    );

    print('๐ค ุฅุฑุณุงู ุงูุจูุงูุงุช...');
    print('FIELD: title = $title');
    print('FIELD: price = $price');
    print('FIELD: category = $category');
    print('FILE: image = ${imageFile.path.split('/').last}');

    final response = await dio.post(
      'https://arthub-backend.up.railway.app/api/artworks',
      data: formData,
      options: Options(
        headers: {
          'Authorization': 'Bearer $token',
        },
        sendTimeout: Duration(seconds: 60),
        receiveTimeout: Duration(seconds: 60),
      ),
      onSendProgress: (sent, total) {
        final progress = sent / total;
        print('๐ค Progress: ${(progress * 100).toStringAsFixed(1)}%');
      },
    );

    print('โ ุชู ุฅูุดุงุก ุงูุนูู ุงูููู ุจูุฌุงุญ');
    print('Response: ${response.data}');
    
  } on DioException catch (e) {
    print('โ Dio Error: ${e.message}');
    print('โ Error Type: ${e.type}');
    print('โ Error Response: ${e.response?.data}');
    print('โ Error Status: ${e.response?.statusCode}');
    rethrow;
  } catch (e) {
    print('โ General Error: $e');
    rethrow;
  }
}
```

### ุงููุดููุฉ: "FIELD: image" ุจุฏูุงู ูู "images"

**ุงูุณุจุจ:** ุงุณู ุงูุญูู ุฎุงุทุฆ ูู ุงูู FormData

#### ุงูุญู:
```dart
// โ ุฎุทุฃ
formData.files.add(
  MapEntry('image', await MultipartFile.fromFile(imageFile.path)) // โ ุฎุทุฃ
);

// โ ุตุญูุญ
formData.files.add(
  MapEntry('images', await MultipartFile.fromFile(imageFile.path)) // โ ุตุญูุญ
);
```

### ุงููุดููุฉ: "Current Request Body" ูุงุฑุบ

**ุงูุณุจุจ:** ูุดููุฉ ูู ุฅุนุฏุงุฏ ุงูู FormData

#### ุงูุญู:
```dart
// ุชุฃูุฏ ูู ุฃู ุงูุจูุงูุงุช ุงููุตูุฉ ุตุญูุญุฉ
final formData = FormData.fromMap({
  'title': title.trim(), // ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ูุณุงูุงุช ุฒุงุฆุฏุฉ
  'price': price.toString(), // ุชุญููู ุงูุฑูู ุฅูู string
  'category': category.trim(),
});

// ุชุฃูุฏ ูู ุฃู ุงูููู ููุฌูุฏ
if (await imageFile.exists()) {
  formData.files.add(
    MapEntry('images', await MultipartFile.fromFile(imageFile.path))
  );
} else {
  throw Exception('ุงูููู ุบูุฑ ููุฌูุฏ: ${imageFile.path}');
}
```

## ๐ง ุชุตุญูุญ ุงูููุฏ ุงูุฎุงุต ุจู

ุจูุงุกู ุนูู ุงูููุฏ ุงูุฐู ุฃุฑุณูุชูุ ุงููุดููุฉ ูู:

### 1. ุชุตุญูุญ ุงูู Cubit
```dart
class AddArtworkCubit extends Cubit<AddArtworkState> {
  AddArtworkCubit() : super(AddArtworkInitial());
  DioHelper dio = DioHelper();
  
  Future<void> addArtwork({
    required String title,
    required int price,
    required String category,
    required File imageFile,
  }) async {
    emit(AddArtworkLoading());
    try {
      final token = await SecureStorage().getAccessToken();
      
      // โ ุชุตุญูุญ ุฅุนุฏุงุฏ FormData
      final formData = FormData.fromMap({
        'title': title.trim(),
        'price': price.toString(), // ุชุญููู ุฅูู string
        'category': category.trim(),
      });

      // โ ุฅุถุงูุฉ ุงูุตูุฑุฉ ุจุดูู ูููุตู
      formData.files.add(
        MapEntry(
          'images', // ุงุณู ุงูุญูู ุงูุตุญูุญ
          await MultipartFile.fromFile(
            imageFile.path,
            filename: 'artwork_${DateTime.now().millisecondsSinceEpoch}.jpg',
          ),
        ),
      );

      // โ ุทุจุงุนุฉ ุงูุจูุงูุงุช ููุชุฃูุฏ
      formData.fields.forEach((f) => print('FIELD: ${f.key} = ${f.value}'));
      formData.files.forEach(
        (f) => print('FILE: ${f.key} = ${f.value.filename}'),
      );

      // โ ุฅุถุงูุฉ timeout ู error handling
      final response = await dio.postData(
        url: ApiConstant.artWorks,
        token: token,
        data: formData,
        options: Options(
          sendTimeout: Duration(seconds: 60),
          receiveTimeout: Duration(seconds: 60),
        ),
      );

      if (response.statusCode == 200 || response.statusCode == 201) {
        final data = AddArtworkModel.fromJson(response.data);
        if (data.success == true && data.data != null) {
          emit(AddArtworkSuccess(data.data!));
        } else {
          emit(AddArtworkFailure(
            data.message ?? 'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅุถุงูุฉ ุงูุนูู ุงูููู',
          ));
        }
      } else {
        emit(AddArtworkFailure(
          'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅุถุงูุฉ ุงูุนูู ุงูููู: ${response.data['message'] ?? 'ุบูุฑ ูุนุฑูู'}',
        ));
      }
    } catch (e, stackTrace) {
      ErrorHandler.logError('AddArtworkCubit.addArtwork', e, stackTrace);

      final errorMessage = e is DioException
          ? e.message ?? 'Network error occurred'
          : 'Unexpected error occurred';

      emit(AddArtworkFailure(errorMessage));
    }
  }
}
```

### 2. ุชุตุญูุญ ุงูู API Constants
ุชุฃูุฏ ูู ุฃู `ApiConstant.artWorks` ูุญุชูู ุนูู:
```dart
class ApiConstant {
  static const String artWorks = '/api/artworks'; // โ ุตุญูุญ
  // ุฃู
  static const String artWorks = 'https://arthub-backend.up.railway.app/api/artworks'; // โ ุตุญูุญ
}
```

### 3. ุชุตุญูุญ ุงูู DioHelper
ุชุฃูุฏ ูู ุฃู `DioHelper.postData` ูุฏุนู `FormData`:
```dart
class DioHelper {
  Future<Response> postData({
    required String url,
    required String token,
    required FormData data,
    Options? options,
  }) async {
    return await dio.post(
      url,
      data: data,
      options: options?.copyWith(
        headers: {
          'Authorization': 'Bearer $token',
          ...?options?.headers,
        },
      ) ?? Options(
        headers: {'Authorization': 'Bearer $token'},
      ),
    );
  }
}
```

## ๐ฏ ุงูุทุฑููุฉ ุงููุฏุนููุฉ: ุฑูุน ูููุงุช ุงูุตูุฑ ูุจุงุดุฑุฉ

### ุงูุทูุจ (Multipart Form Data)

```dart
import 'dart:io';
import 'package:http/http.dart' as http;

Future<void> createArtworkWithImages() async {
  // ุฅุนุฏุงุฏ ุงูุจูุงูุงุช ุญุณุจ ูุงุฌูุฉ ุงููุณุชุฎุฏู
  final title = "ููุญุฉ ูููุฉ ุฒูุฑูุฉ ุฒุฑูุงุก ูุฑุณููุฉ ูุฏููุง";
  final description = "ูุตู ุงูุนูู ุงูููู";
  final price = 100;
  final category = "ุฑุณู"; // ุงุณู ุงููุฆุฉ ููุง ูุธูุฑ ูู ุงููุงุฌูุฉ
  
  // ูุงุฆูุฉ ูููุงุช ุงูุตูุฑ (ูู 1 ุฅูู 5 ุตูุฑ)
  final List<File> imageFiles = [
    File('/path/to/image1.jpg'),
    File('/path/to/image2.jpg'),
    File('/path/to/image3.jpg'),
  ];

  // ุฅูุดุงุก multipart request
  final request = http.MultipartRequest(
    'POST',
    Uri.parse('https://arthub-backend.up.railway.app/api/artworks'),
  );

  // ุฅุถุงูุฉ headers
  request.headers['Authorization'] = 'Bearer $token';
  request.headers['Content-Type'] = 'multipart/form-data';

  // ุฅุถุงูุฉ ุงูุจูุงูุงุช ุงููุตูุฉ ุญุณุจ ูุงุฌูุฉ ุงููุณุชุฎุฏู
  request.fields['title'] = title;
  request.fields['description'] = description;
  request.fields['price'] = price.toString();
  request.fields['category'] = category; // ุงุณู ุงููุฆุฉ ูู string

  // ุฅุถุงูุฉ ูููุงุช ุงูุตูุฑ
  for (int i = 0; i < imageFiles.length; i++) {
    final file = imageFiles[i];
    final stream = http.ByteStream(file.openRead());
    final length = await file.length();
    
    final multipartFile = http.MultipartFile(
      'images', // ุงุณู ุงูุญูู ูู ุงูู backend
      stream,
      length,
      filename: 'artwork_${DateTime.now().millisecondsSinceEpoch}_$i.jpg',
    );
    
    request.files.add(multipartFile);
  }

  // ุฅุฑุณุงู ุงูุทูุจ
  try {
    final response = await request.send();
    final responseData = await response.stream.bytesToString();
    
    if (response.statusCode == 201) {
      print('โ ุชู ุฅูุดุงุก ุงูุนูู ุงูููู ุจูุฌุงุญ');
      print(responseData);
    } else {
      print('โ ูุดู ูู ุฅูุดุงุก ุงูุนูู ุงูููู');
      print(responseData);
    }
  } catch (e) {
    print('โ ุฎุทุฃ ูู ุงูุงุชุตุงู: $e');
  }
}
```

### ูุซุงู ุจุงุณุชุฎุฏุงู Dio (ุงูุฃูุถู)

```dart
import 'package:dio/dio.dart';

Future<void> createArtworkWithDio() async {
  final dio = Dio();
  
  // ุฅุนุฏุงุฏ ุงูุจูุงูุงุช ุญุณุจ ูุงุฌูุฉ ุงููุณุชุฎุฏู
  final formData = FormData.fromMap({
    'title': 'ููุญุฉ ูููุฉ ุฒูุฑูุฉ ุฒุฑูุงุก ูุฑุณููุฉ ูุฏููุง',
    'description': 'ูุตู ุงูุนูู ุงูููู',
    'price': 100,
    'category': 'ุฑุณู', // ุงุณู ุงููุฆุฉ
  });

  // ุฅุถุงูุฉ ุงูุตูุฑ (ูู 1 ุฅูู 5 ุตูุฑ)
  final List<File> images = [
    File('/path/to/image1.jpg'),
    File('/path/to/image2.jpg'),
  ];

  for (int i = 0; i < images.length; i++) {
    formData.files.add(
      MapEntry(
        'images',
        await MultipartFile.fromFile(
          images[i].path,
          filename: 'artwork_${DateTime.now().millisecondsSinceEpoch}_$i.jpg',
        ),
      ),
    );
  }

  try {
    final response = await dio.post(
      'https://arthub-backend.up.railway.app/api/artworks',
      data: formData,
      options: Options(
        headers: {
          'Authorization': 'Bearer $token',
        },
        sendTimeout: Duration(seconds: 30),
        receiveTimeout: Duration(seconds: 30),
      ),
      onSendProgress: (sent, total) {
        final progress = sent / total;
        print('Upload progress: ${(progress * 100).toStringAsFixed(1)}%');
      },
    );

    if (response.statusCode == 201) {
      print('โ ุชู ุฅูุดุงุก ุงูุนูู ุงูููู ุจูุฌุงุญ');
      print(response.data);
    }
  } catch (e) {
    print('โ ุฎุทุฃ: $e');
  }
}
```

## ๐ ุชูุงุตูู API

### Endpoint
```
POST /api/artworks
```

### Headers ุงููุทููุจุฉ
```
Authorization: Bearer <token>
Content-Type: multipart/form-data
```

### ุงูุจูุงูุงุช ุงููุทููุจุฉ

```dart
// ุงูุจูุงูุงุช ุงููุตูุฉ
title: String (ูุทููุจ) - ุนููุงู ุงูุนูู ุงูููู
description: String (ุงุฎุชูุงุฑู) - ูุตู ุงูุนูู ุงูููู
price: int (ูุทููุจ) - ุงูุณุนุฑ ุจุงูุฏููุงุฑ
category: String (ูุทููุจ) - ุงุณู ุงููุฆุฉ (ูุซู: "ุฑุณู")

// ูููุงุช ุงูุตูุฑ
images: List<File> (ูุทููุจ) - ูู 1 ุฅูู 5 ุตูุฑ
```

## โ ุงูุงุณุชุฌุงุจุฉ ุงููุงุฌุญุฉ

```json
{
  "success": true,
  "message": "ุชู ุฅูุดุงุก ุงูุนูู ุงูููู ุจูุฌุงุญ",
  "data": {
    "_id": "507f1f77bcf86cd799439011",
    "title": "ููุญุฉ ูููุฉ ุฒูุฑูุฉ ุฒุฑูุงุก ูุฑุณููุฉ ูุฏููุง",
    "description": "ูุตู ุงูุนูู ุงูููู",
    "price": 100,
    "category": {
      "_id": "507f1f77bcf86cd799439012",
      "name": "ุฑุณู"
    },
    "artist": {
      "_id": "507f1f77bcf86cd799439013",
      "displayName": "ุฃุญูุฏ ูุญูุฏ"
    },
    "image": "https://res.cloudinary.com/demo/image/upload/v1234567890/artwork_main.jpg",
    "images": [
      "https://res.cloudinary.com/demo/image/upload/v1234567890/artwork1.jpg",
      "https://res.cloudinary.com/demo/image/upload/v1234567890/artwork2.jpg"
    ],
    "status": "available",
    "createdAt": "2024-01-01T00:00:00.000Z"
  }
}
```

## โ ุงูุฃุฎุทุงุก ุงููุญุชููุฉ

### 1. ุฎุทุฃ ูู ุงูุตูุฑ
```json
{
  "success": false,
  "message": "ูุฌุจ ุฅุถุงูุฉ ุตูุฑุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู ููุนูู ุงูููู",
  "data": null
}
```

### 2. ุฎุทุฃ ูู ุนุฏุฏ ุงูุตูุฑ
```json
{
  "success": false,
  "message": "ูููู ุฅุถุงูุฉ 5 ุตูุฑ ุนูู ุงูุฃูุซุฑ",
  "data": null
}
```

### 3. ุฎุทุฃ ูู ููุน ุงูููู
```json
{
  "success": false,
  "message": "ููุน ุงูููู ุบูุฑ ูุฏุนูู",
  "data": null
}
```

### 4. ุฎุทุฃ ูู ุงููุฆุฉ
```json
{
  "success": false,
  "message": "ุงููุฆุฉ ุงููุญุฏุฏุฉ ุบูุฑ ููุฌูุฏุฉ",
  "data": null
}
```

## ๐ง ุฃููุงุน ุงููููุงุช ุงููุฏุนููุฉ

- **PNG** (.png)
- **JPEG** (.jpg, .jpeg)
- **GIF** (.gif)
- **WebP** (.webp)
- **SVG** (.svg)
- **BMP** (.bmp)
- **TIFF** (.tiff)

## ๐ ูููุฏ ุงูุตูุฑ

- **ุงูุญุฏ ุงูุฃูุตู:** 5 ุตูุฑ ููู ุนูู ููู (ููุง ูุธูุฑ ูู ุงููุงุฌูุฉ)
- **ุงูุญุฏ ุงูุฃุฏูู:** ุตูุฑุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู
- **ุงูุญุฌู:** ููุถู ุฃูู ูู 10MB ููู ุตูุฑุฉ
- **ุงูุฃุจุนุงุฏ:** ุณูุชู ุชุญุณูู ุงูุตูุฑ ุชููุงุฆูุงู ุฅูู 1920x1080

## ๐ก ูุตุงุฆุญ ููู Flutter

### 1. ุงุฎุชูุงุฑ ุงูุตูุฑ
```dart
import 'package:image_picker/image_picker.dart';

Future<List<File>> pickImages() async {
  final ImagePicker picker = ImagePicker();
  final List<XFile> images = await picker.pickMultiImage(
    maxWidth: 1920,
    maxHeight: 1080,
    imageQuality: 85,
  );
  
  return images.map((xFile) => File(xFile.path)).toList();
}
```

### 2. ุนุฑุถ ุชูุฏู ุงูุฑูุน
```dart
void showUploadProgress(double progress) {
  // ุนุฑุถ progress bar ููุง ูุธูุฑ ูู ุงููุงุฌูุฉ
  print('ุชุญููู ... ${(progress * 100).toStringAsFixed(1)}%');
}
```

### 3. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
```dart
void handleUploadError(String error) {
  // ุนุฑุถ ุฑุณุงูุฉ ุฎุทุฃ ูููุณุชุฎุฏู
  ScaffoldMessenger.of(context).showSnackBar(
    SnackBar(content: Text(error)),
  );
}
```

### 4. ูุซุงู ูุงูู ูุน State Management
```dart
class ArtworkService {
  final Dio _dio = Dio();
  
  Future<ArtworkResponse> createArtwork({
    required String title,
    required String description,
    required int price,
    required String category,
    required List<File> images,
    required String token,
    Function(double)? onProgress,
  }) async {
    try {
      final formData = FormData.fromMap({
        'title': title,
        'description': description,
        'price': price,
        'category': category, // ุงุณู ุงููุฆุฉ ูู string
      });

      for (int i = 0; i < images.length; i++) {
        formData.files.add(
          MapEntry(
            'images',
            await MultipartFile.fromFile(
              images[i].path,
              filename: 'artwork_${DateTime.now().millisecondsSinceEpoch}_$i.jpg',
            ),
          ),
        );
      }

      final response = await _dio.post(
        'https://arthub-backend.up.railway.app/api/artworks',
        data: formData,
        options: Options(
          headers: {'Authorization': 'Bearer $token'},
          sendTimeout: Duration(seconds: 30),
          receiveTimeout: Duration(seconds: 30),
        ),
        onSendProgress: (sent, total) {
          if (onProgress != null) {
            onProgress(sent / total);
          }
        },
      );

      return ArtworkResponse.fromJson(response.data);
    } catch (e) {
      throw ArtworkException('ูุดู ูู ุฅูุดุงุก ุงูุนูู ุงูููู: $e');
    }
  }
}
```

## ๐ฏ ุงูุชูุตูุฉ

**ุงุณุชุฎุฏู Dio** ูุฃูู:
- โ ูุฏุนู progress tracking (ููุง ูุธูุฑ ูู ุงููุงุฌูุฉ)
- โ ูุฏุนู timeout configuration
- โ ูุฏุนู retry logic
- โ ุฃูุซุฑ ุงุณุชูุฑุงุฑุงู
- โ ูุชุทุงุจู ูุน ููุทู ุงููุงุฌูุฉ

## ๐ฆ ุงูู Dependencies ุงููุทููุจุฉ

```yaml
dependencies:
  flutter:
    sdk: flutter
  
  # ููู HTTP requests
  dio: ^5.4.0
  
  # ูุงุฎุชูุงุฑ ุงูุตูุฑ
  image_picker: ^1.0.4
  
  # ููู state management
  provider: ^6.1.1
  
  # ููู JSON parsing
  json_annotation: ^4.8.1

dev_dependencies:
  build_runner: ^2.4.7
  json_serializable: ^6.7.1
```

---

## ๐จ **ุงูุญู ุงูููุงุฆู ููุดููุฉ Flutter Upload**

### **ุงููุดููุฉ ุงูุฃุณุงุณูุฉ:**
- ุงูู Flutter ุจููู ุนูุฏ `dio.postData` ููุง ูููู
- ุงูู backend ุจูุณุชูุจู FormData ูุงุฑุบ
- ุงูู DioHelper.postData ูุด ุดุบุงู ุจุดูู ุตุญูุญ

### **ุงูุญู ุงูููุงุฆู:**

#### **1. ุชุตุญูุญ ุงูู AddArtworkCubit:**

```dart
import 'dart:io';
import 'package:dio/dio.dart';
import 'package:art_hub/core/utils/error_handler.dart';
import 'package:art_hub/features/add_artwork/data/add_artwork_model/add_artwork_model.dart';
import 'package:art_hub/services/secure_storage.dart';
import 'package:bloc/bloc.dart';
import 'package:equatable/equatable.dart';

part 'add_artwork_state.dart';

class AddArtworkCubit extends Cubit<AddArtworkState> {
  AddArtworkCubit() : super(AddArtworkInitial());
  
  Future<void> addArtwork({
    required String title,
    required int price,
    required String category,
    required File imageFile,
  }) async {
    emit(AddArtworkLoading());
    try {
      final token = await SecureStorage().getAccessToken();
      
      // ุงูุชุญูู ูู ุงูู token
      if (token == null || token.isEmpty) {
        emit(AddArtworkFailure('Token ุบูุฑ ุตุญูุญ'));
        return;
      }
      
      print('๐ Token exists:', token.isNotEmpty);
      
      // ุฅูุดุงุก Dio ูุจุงุดุฑุฉ
      final dio = Dio();
      
      // ุฅูุดุงุก FormData
      final formData = FormData.fromMap({
        'title': title.trim(),
        'price': price.toString(),
        'category': category.trim(),
      });

      // ุฅุถุงูุฉ ุงูุตูุฑุฉ
      formData.files.add(
        MapEntry(
          'images',
          await MultipartFile.fromFile(
            imageFile.path,
            filename: 'artwork_${DateTime.now().millisecondsSinceEpoch}.jpg',
          ),
        ),
      );

      // ุทุจุงุนุฉ ุงูุจูุงูุงุช ููุชุฃูุฏ
      formData.fields.forEach((f) => print('FIELD: ${f.key} = ${f.value}'));
      formData.files.forEach((f) => print('FILE: ${f.key} = ${f.value.filename}'));

      print('๐ค Sending request to: https://arthub-backend.up.railway.app/api/artworks');
      
      // ุฅุฑุณุงู ุงูุทูุจ ูุจุงุดุฑุฉ
      final response = await dio.post(
        'https://arthub-backend.up.railway.app/api/artworks',
        data: formData,
        options: Options(
          headers: {
            'Authorization': 'Bearer $token',
          },
          sendTimeout: Duration(seconds: 30),
          receiveTimeout: Duration(seconds: 30),
        ),
      );

      print('๐ฅ Response received:', response.statusCode);
      
      if (response.statusCode == 200 || response.statusCode == 201) {
        final data = AddArtworkModel.fromJson(response.data);
        if (data.success == true && data.data != null) {
          emit(AddArtworkSuccess(data.data!));
        } else {
          emit(AddArtworkFailure(
            data.message ?? 'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅุถุงูุฉ ุงูุนูู ุงูููู',
          ));
        }
      } else {
        emit(AddArtworkFailure(
          'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅุถุงูุฉ ุงูุนูู ุงูููู: ${response.data['message'] ?? 'ุบูุฑ ูุนุฑูู'}',
        ));
      }
    } catch (e, stackTrace) {
      print('โ Error in addArtwork:', e);
      print('โ Error type:', e.runtimeType);
      
      ErrorHandler.logError('AddArtworkCubit.addArtwork', e, stackTrace);
      
      final errorMessage = e is DioException
          ? e.message ?? 'Network error occurred'
          : 'Unexpected error occurred';

      emit(AddArtworkFailure(errorMessage));
    }
  }
}
```

#### **2. ุชุตุญูุญ ุงูู API Constants:**

```dart
class ApiConstant {
  // ุงุณุชุฎุฏู ุงูู URL ุงููุงูู
  static const String artWorks = 'https://arthub-backend.up.railway.app/api/artworks';
  static const String categories = 'https://arthub-backend.up.railway.app/api/categories';
  // ... ุจุงูู ุงูู endpoints
}
```

#### **3. ุชุตุญูุญ ุงูู AddArtworkScreen:**

```dart
// ูู ุงูู _buildPublishButton method
Widget _buildPublishButton() {
  return SizedBox(
    width: double.infinity,
    child: ElevatedButton(
      onPressed: () async {
        if (_selectedImage == null ||
            artworkController.text.isEmpty ||
            priceController.text.isEmpty ||
            _selectedCategory == null) {
          ScaffoldMessenger.of(context).showSnackBar(
            SnackBar(content: Text('Please fill all fields')),
          );
          return;
        }

        // ุชุญููู ุงูุณุนุฑ ุฅูู int
        final price = int.tryParse(priceController.text);
        if (price == null) {
          ScaffoldMessenger.of(context).showSnackBar(
            SnackBar(content: Text('ุงูุณุนุฑ ุบูุฑ ุตุญูุญ')),
          );
          return;
        }

        context.read<AddArtworkCubit>().addArtwork(
          title: artworkController.text,
          price: price,
          category: _selectedCategory!,
          imageFile: _selectedImage!,
        );
      },
      style: ElevatedButton.styleFrom(
        backgroundColor: ColorsManagers.ceil,
        padding: const EdgeInsets.symmetric(vertical: 16),
        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(8)),
      ),
      child: Text(
        'ูุดุฑ ุงูุนูู',
        style: TextStyles.font16WhiteW500Tajawal(context),
      ),
    ),
  );
}
```

#### **4. ุฅุถุงูุฉ Error Handling ุดุงูู:**

```dart
// ูู ุงูู BlocConsumer
BlocConsumer<AddArtworkCubit, AddArtworkState>(
  listener: (context, state) {
    if (state is AddArtworkSuccess) {
      showDialog(
        context: context,
        builder: (_) => SuccessDialog(message: 'ุชู ูุดุฑ ุนููู ุจูุฌุงุญ!'),
      );
      // ุชูุธูู ุงูุญููู
      artworkController.clear();
      priceController.clear();
      setState(() {
        _selectedImage = null;
        _selectedCategory = null;
      });
    } else if (state is AddArtworkFailure) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(
          content: Text(state.error),
          backgroundColor: Colors.red,
          duration: Duration(seconds: 5),
        ),
      );
    }
  },
  builder: (context, state) {
    return Scaffold(
      body: Directionality(
        textDirection: TextDirection.rtl,
        child: Padding(
          padding: const EdgeInsets.symmetric(horizontal: 32.0),
          child: SingleChildScrollView(
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                // ... ุจุงูู ุงูู UI
                
                // Publish Button ูุน loading state
                SizedBox(
                  width: double.infinity,
                  child: ElevatedButton(
                    onPressed: state is AddArtworkLoading 
                        ? null 
                        : () async {
                            // ... ููุณ ุงูููุฏ ุงูุณุงุจู
                          },
                    style: ElevatedButton.styleFrom(
                      backgroundColor: ColorsManagers.ceil,
                      padding: const EdgeInsets.symmetric(vertical: 16),
                      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(8)),
                    ),
                    child: state is AddArtworkLoading
                        ? CircularProgressIndicator(color: Colors.white)
                        : Text(
                            'ูุดุฑ ุงูุนูู',
                            style: TextStyles.font16WhiteW500Tajawal(context),
                          ),
                  ),
                ),
              ],
            ),
          ),
        ),
      ),
    );
  },
)
```

#### **5. ุงูุชุฃูุฏ ูู ุงูู Dependencies:**

```yaml
# ูู pubspec.yaml
dependencies:
  flutter:
    sdk: flutter
  
  # ููู HTTP requests
  dio: ^5.4.0
  
  # ูุงุฎุชูุงุฑ ุงูุตูุฑ
  image_picker: ^1.0.4
  
  # ููู state management
  flutter_bloc: ^8.1.3
  equatable: ^2.0.5
  
  # ููู secure storage
  flutter_secure_storage: ^9.0.0
```

#### **6. ุงุฎุชุจุงุฑ ุงูู endpoint:**

```dart
// ุฃุถู ูุฐุง method ููุงุฎุชุจุงุฑ
Future<void> testEndpoint() async {
  try {
    final token = await SecureStorage().getAccessToken();
    final dio = Dio();
    
    // ุงุฎุชุจุงุฑ ุจุณูุท
    final response = await dio.get(
      'https://arthub-backend.up.railway.app/api/categories',
      options: Options(
        headers: {'Authorization': 'Bearer $token'},
      ),
    );
    
    print('โ Test successful:', response.statusCode);
  } catch (e) {
    print('โ Test failed:', e);
  }
}
```

## ๐ฏ **ุงูุฎุทูุงุช ุงููุทููุจุฉ:**

1. **ุงุณุชุจุฏู ุงูู AddArtworkCubit** ุจุงูููุฏ ุงูุฌุฏูุฏ
2. **ุชุฃูุฏ ูู ุงูู API Constants** ุชุณุชุฎุฏู ุงูู URL ุงููุงูู
3. **ุฃุถู ุงูู error handling** ุงูุดุงูู
4. **ุงุฎุชุจุฑ ุงูู endpoint** ุฃููุงู
5. **ุฌุฑุจ ุงูู upload** ูุน ุงูุตูุฑ

**ูุฐุง ุงูุญู ูุชุฌุงูุฒ ุงูู DioHelper ุชูุงูุงู ููุณุชุฎุฏู Dio ูุจุงุดุฑุฉุ ููุง ูุญู ูุดููุฉ ุงูู network request!** ๐

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ:** ููุงูุฑ 2024  
**ุงููุทูุฑ:** ูุฑูู ArtHub  
**ุงูุฅุตุฏุงุฑ:** 1.0.1 